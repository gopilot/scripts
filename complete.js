function getParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp("[\\?&]"+e+"=([^&#]*)"),a=s.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}jQuery(function(e){function s(s){if(e(s).siblings(".status").removeClass("pe-7s-check pe-7s-close-circle"),e(s).val().length>0){var a=e(s).data("validation"),r=e(s).attr("name");console.log("Checking",e(s).val(),l[a],e(s).val().match(l[a])),e(s).val().match(l[a])?e(s).siblings(".status").addClass("pe-7s-check"):(e(s).siblings(".status").addClass("pe-7s-close-circle"),e(".error-messages .message."+r).length?e(".error-messages .message."+r).text(e(s).data("error")):e(".error-messages").append("<div class='message "+r+"'>"+e(s).data("error")+"</div>"))}e(".error-messages .message."+r).remove()}function a(){var s={};return e(".toggle-group").each(function(a){console.log(a);var r=e(this).attr("name");e(this).children(".selected").length?s[r]=e(this).children(".selected").attr("value"):e(".error-messages .message."+r).length?e(".error-messages .message."+r).text(e(this).data("error")):e(".error-messages").append("<div class='message "+r+"'>"+e(this).data("error")+"</div>")}),e("input, textarea").each(function(){var a=e(this).attr("name"),r=e(this).data("validation");e(this).val().match(l[r])||!e(this).attr("required")?(e(this).siblings(".status").addClass("pe-7s-check"),s[a]=e(this).val()):(e(this).siblings(".status").addClass("pe-7s-close-circle"),e(".error-messages .message."+a).length?e(".error-messages .message."+a).text(e(this).data("error")):e(".error-messages").append("<div class='message "+a+"'>"+e(this).data("error")+"</div>"))}),s.notes={},s.notes[PILOT_EVENT_ID]=s.event_notes,s.has_experience="1"===s.has_experience||s.has_experience&&"false"==s.has_experience.toLowerCase(),delete s.event_notes,s}function r(e){return e.name&&e.email&&e.gender&&e.birth_date&&e.grade&&e.phone&&e.emergency_name&&e.emergency_email&&e.emergency_phone&&e.emergency_email&&(e.has_experience||e.has_experience===!1)&&(e.has_experience?e.experience_years:!0)&&e.shirt_type&&e.shirt_size&&e.password}function t(s){e.ajax({url:"https://api.gopilot.org/users/"+o,data:JSON.stringify(s),type:"PUT",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("session",n)}}).error(function(s){console.log("ERROR!",s),e(".error-container").addClass("shown")}).done(function(e){console.log("DONE!!!",e),clearTimeout(c),window.location="/confirmation.html"})}e("input, textarea").typeWatch({event:"typingDone",wait:750});var n,o,i;e.get("https://api.gopilot.org/users/find_incomplete/"+getParameter("token"),function(s){return s&&s.session&&s.user?(document.cookie="session="+s.session,n=s.session,i={name:s.user.name,email:s.user.email,id:s.user.id},e(".js-name").val(i.name),e(".js-email").val(i.email),void(o=i.id)):(e(".error-container").addClass("shown"),console.log("ERROR",s))}).error(function(s){return e(".error-container").addClass("shown"),console.log("ERROR",s)});var l={name:/^[a-zA-Z\\s]+ /i,phone:/[0-9-\(\)]{10,12}/,email:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}\b/i,experience:/[0-9]*/,date:/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/,password:/.{8,}/};s("input.js-name"),s("input.js-email"),e("input[required]").on("typingDone",function(){s(this)}),e("input[required]").on("blur",function(){s(this)}),e(".toggle-button").on("click",function(){var s=e(this).parent().attr("name");e(this).siblings().removeClass("selected"),e(this).toggleClass("selected"),"has_experience"==s&&("1"==e(this).attr("value")?(console.log("remove hidden"),e(".input-container.experience").removeClass("hidden")):(console.log("add hidden",e(this).attr("value")),e(".input-container.experience").addClass("hidden"))),e(".error-messages .message."+s).remove()});var c;e(".js-submit").on("click",function(){e(".error-messages").children().remove(),c=setTimeout(function(){e(".error-container").addClass("shown")},1e4),i=a(),r(i)?(delete i.confirm_password,console.log(i),t(i)):(console.log("error",i),clearTimeout(c),e("i.status:not(.pe-7s-check)").addClass("pe-7s-close-circle"))})});